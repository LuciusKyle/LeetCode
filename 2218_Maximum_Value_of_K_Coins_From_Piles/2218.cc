
#include <chrono>
#include <iostream>
#include <vector>

using std::cout;
using std::endl;
using std::vector;

class Solution {
 public:
  int maxValueOfCoins(vector<vector<int>>& piles, int k) {
    vector<vector<int>> dp(piles.size(), vector<int>(k + 1, -1));
    dp[0][0] = 0;
    for (int i = 0; i < k && i < piles[0].size(); ++i)
      dp[0][i + 1] = dp[0][i] + piles[0][i];
    for (int pile_index = 1; pile_index < piles.size(); ++pile_index) {
      dp[pile_index][0] = 0;
      vector<int> prefix_sum;
      prefix_sum.reserve(piles[pile_index].size());
      prefix_sum.push_back(0);
      for (int i = 0; i < piles[pile_index].size(); ++i)
        prefix_sum.push_back(prefix_sum.back() + piles[pile_index][i]);
      for (int count = 1; count <= k; ++count) {
        int max_coins = 0;
        for (int i = std::max(count - int(prefix_sum.size()) + 1, 0); i <= count; ++i) {
          if (dp[pile_index - 1][i] == -1) break;
          if (max_coins < dp[pile_index - 1][i] + prefix_sum[count - i]) {
            max_coins = dp[pile_index - 1][i] + prefix_sum[count - i];
          }
        }
        dp[pile_index][count] = max_coins;
      }
    }
    return dp.back().back();
  }
};

int main(int argc, char* argv[]) {
  vector<vector<int>> test_vec{{1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}};
  Solution sln;
  auto start = std::chrono::system_clock::now();
  cout << sln.maxValueOfCoins(test_vec, 1000) << "\n";
  cout << std::chrono::duration_cast<std::chrono::milliseconds>(std::chrono::system_clock::now() - start).count() << " milliseconds\n";
  cout << endl;
  return 0;
}
