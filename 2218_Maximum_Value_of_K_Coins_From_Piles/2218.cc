
#include <chrono>
#include <iostream>
#include <vector>

using std::cout;
using std::endl;
using std::vector;

class Solution {
 public:
  int maxValueOfCoins(const vector<vector<int>>& piles, const int k) {
    vector<int> curr_max(k + 1, -1), pre_max(k + 1, -1);
    pre_max[0] = 0;
    curr_max[0] = 0;
    for (int i = 0; i < std::min(k, int(piles[0].size())); ++i)
      pre_max[i + 1] = pre_max[i] + piles[0][i];
    for (int pile_index = 1; pile_index < piles.size(); ++pile_index) {
      vector<int> prefix_sum;
      prefix_sum.reserve(piles[pile_index].size());
      prefix_sum.push_back(0);
      for (int i = 0; i < piles[pile_index].size(); ++i)
        prefix_sum.push_back(prefix_sum.back() + piles[pile_index][i]);
      for (int count = 1; count <= k; ++count) {
        int max_coins = 0;
        for (int i = std::max(count - int(prefix_sum.size()) + 1, 0); i <= count; ++i) {
          if (pre_max[i] == -1) break;
          max_coins = std::max(max_coins, pre_max[i] + prefix_sum[count - i]);
        }
        curr_max[count] = max_coins;
      }
      curr_max.swap(pre_max);
    }
    return pre_max.back();
  }
};

int main(int argc, char* argv[]) {
  vector<vector<int>> test_vec{{1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}, {1, 100000}, {1}, {100000, 1}, {100000}};
  Solution sln;
  auto start = std::chrono::system_clock::now();
  cout << sln.maxValueOfCoins(test_vec, 1000) << "\n";
  cout << std::chrono::duration_cast<std::chrono::milliseconds>(std::chrono::system_clock::now() - start).count() << " milliseconds\n";
  cout << endl;
  return 0;
}
